<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rounds - Sabbath Event</title>
    <link rel="icon" type="image/png" href="img/logopage.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <!-- Banner Section -->
    <section class="banner-section">
        <video class="banner-video" autoplay loop muted playsinline>
            <source src="img/sabbathcropped (online-video-cutter.com)-2.mp4" type="video/mp4">
        </video>
        <img src="img/sabbath_logo.png" alt="Sabbath Banner" class="banner-logo">
    </section>

    <nav class="navbar">
        <div class="nav-brand">
            <img src="img/sabbath_logo.png" alt="Sabbath Logo" class="logo">
        </div>
        <div class="nav-links">
            <a href="index.html">HOME</a>
            <a href="Apply.html">APPLY</a>
            <a href="Rounds.html">ROUNDS</a>
            <a href="giveaway.html">GIVEAWAY</a>
            <a href="admin/login.html" class="admin-link"><i class="fas fa-user-shield"></i></a>
        </div>
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <section class="rounds">
        <div class="container">
            <h2>Rounds</h2>
            <div id="rounds-container" class="rounds-container">
                <!-- Rounds will be loaded here dynamically -->
                <div class="loading-spinner" style="text-align: center; color: white;">Loading rounds...</div>
            </div>

            <!-- Template for a round card (hidden) -->
            <template id="round-card-template">
                <a href="#" class="round-card">
                    <div class="round-image">
                        <img src="" alt="Round Image">
                    </div>
                    <div class="round-content">
                        <h3></h3>
                        <p class="participants"></p>
                        <div class="round-dates">
                            <span></span>
                        </div>
                    </div>
                </a>
            </template>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="social-links">
                    <a href="https://www.flickr.com/photos/192849221@N06/" target="_blank" class="social-link">
                        <i class="fab fa-flickr"></i>
                        <span>Flickr</span>
                    </a>
                    <a href="https://www.instagram.com/sabbathevent.sl/" target="_blank" class="social-link">
                        <i class="fab fa-instagram"></i>
                        <span>Instagram</span>
                    </a>
                    <a href="https://www.facebook.com/groups/3425981114290586" target="_blank" class="social-link">
                        <i class="fab fa-facebook"></i>
                        <span>Facebook</span>
                    </a>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2024 Sabbath Events. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
        import { SUPABASE_URL, SUPABASE_KEY } from './js/config.js';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const roundsContainer = document.getElementById('rounds-container');
        const template = document.getElementById('round-card-template');

        async function loadRounds() {
            try {
                const { data: rounds, error } = await supabase
                    .from('rounds')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                roundsContainer.innerHTML = ''; // Clear loading spinner

                if (rounds.length === 0) {
                    roundsContainer.innerHTML = '<p style="color: white; text-align: center;">No rounds found.</p>';
                    return;
                }

                rounds.forEach(round => {
                    const clone = template.content.cloneNode(true);
                    const card = clone.querySelector('.round-card');

                    // Link to a generic round page or specific one if we had it. 
                    // For now, linking to # or a detail page we might create later.
                    // User said: "configuraremos otro apartado en el que podremos entrar en cada Round"
                    // I'll link to a detail page passing the ID, e.g., round-detail.html?id=...
                    // But for now, let's keep it simple or link to the existing round1.html as placeholder?
                    // User said "replicating what each section has".
                    // I'll link to `round-detail.html?id=${round.id}` (which I haven't created yet, but is good practice)
                    // Or just `#` for now.
                    card.href = `round-detail.html?id=${round.id}`;

                    const img = clone.querySelector('img');
                    img.src = round.image_url || 'img/eventest.jpg'; // Fallback image
                    img.alt = round.name;

                    clone.querySelector('h3').textContent = round.name;
                    clone.querySelector('.participants').textContent = round.participants;
                    clone.querySelector('.round-dates span').textContent = round.dates;

                    roundsContainer.appendChild(clone);
                });
            } catch (error) {
                console.error('Error loading rounds:', error);
                roundsContainer.innerHTML = '<p style="color: red; text-align: center;">Error loading rounds.</p>';
            }
        }

        loadRounds();
    </script>
    <script src="app.js"></script>
</body>

</html>